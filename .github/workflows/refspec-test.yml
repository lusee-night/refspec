name: luseepy-test
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Enable manual activation, too
  workflow_dispatch:
jobs:
  refcpec-build:
    runs-on: ubuntu-latest
    container: buddhasystem/lusee-night-refspec-foundation:0.1 
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        # Check later why this doesn't work anymore: - run: ls ${{ github.workspace }}
      - run: make
      - run: ./test/test_pfb.out > ./pfb_test1.dat
      - run: cat ./pfb_test1.dat
      - run: python3 -c "import numpy as np; a=np.loadtxt('pfb_test1.dat')[:,1]; b=np.loadtxt('data/pfb_test1.dat')[:,1]; assert(np.all(np.abs(a-b)/(0.5*(a+b))<1e-4))"
      - run: echo 'end'
      
